# Docker Actions é…ç½®å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. GitHub Actions å·¥ä½œæµï¼ˆ2 ä¸ªï¼‰

#### `.github/workflows/docker-publish.yml`
- âœ… å¤šæž¶æž„æž„å»ºï¼ˆamd64/arm64ï¼‰
- âœ… è‡ªåŠ¨æŽ¨é€åˆ° GHCR
- âœ… å¯é€‰ Docker Hub æ”¯æŒ
- âœ… æ™ºèƒ½æ ‡ç­¾ç®¡ç†
- âœ… æž„å»ºç¼“å­˜ä¼˜åŒ–
- âœ… æž„å»ºäº§ç‰©ç­¾å

#### `.github/workflows/docker-multi-service.yml`
- âœ… åˆ†ç¦» API é•œåƒæž„å»º
- âœ… åˆ†ç¦» Worker é•œåƒæž„å»º
- âœ… ç‹¬ç«‹ç¼“å­˜ç­–ç•¥
- âœ… ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†

### 2. Docker é…ç½®æ›´æ–°ï¼ˆ4 ä¸ªæ–‡ä»¶ï¼‰

#### `Dockerfile`ï¼ˆå¢žå¼ºï¼‰
- âœ… å¤šæž„å»ºç›®æ ‡ï¼ˆapi/worker/defaultï¼‰
- âœ… éž root ç”¨æˆ·è¿è¡Œ
- âœ… å¥åº·æ£€æŸ¥
- âœ… æž„å»ºå‚æ•°æ”¯æŒ
- âœ… æ—¶åŒºé…ç½®

#### `.dockerignore`ï¼ˆæ–°å¢žï¼‰
- âœ… ä¼˜åŒ–æž„å»ºä¸Šä¸‹æ–‡
- âœ… æŽ’é™¤ä¸å¿…è¦æ–‡ä»¶
- âœ… å‡å°‘é•œåƒå¤§å°

#### `docker-compose.yml`ï¼ˆæ›´æ–°ï¼‰
- âœ… ä½¿ç”¨æž„å»ºç›®æ ‡
- âœ… æ˜Žç¡®æŒ‡å®š target

#### `docker-compose.prod.yml`ï¼ˆæ–°å¢žï¼‰
- âœ… ä½¿ç”¨é¢„æž„å»ºé•œåƒ
- âœ… å®Œæ•´çŽ¯å¢ƒå˜é‡é…ç½®
- âœ… ç”Ÿäº§çº§é…ç½®

### 3. æ–‡æ¡£ï¼ˆ3 ä¸ªï¼‰

#### `DOCKER_DEPLOYMENT.md`ï¼ˆæ–°å¢žï¼‰
- âœ… å®Œæ•´éƒ¨ç½²æŒ‡å—
- âœ… 3 ç§éƒ¨ç½²æ–¹å¼
- âœ… æ‰©å±•å’Œç»´æŠ¤
- âœ… æ•…éšœæŽ’é™¤
- âœ… å®‰å…¨å»ºè®®

#### `GITHUB_ACTIONS.md`ï¼ˆæ–°å¢žï¼‰
- âœ… CI/CD æµç¨‹è¯´æ˜Ž
- âœ… å·¥ä½œæµè¯¦è§£
- âœ… æ ‡ç­¾ç­–ç•¥
- âœ… ä½¿ç”¨ç¤ºä¾‹
- âœ… æ€§èƒ½ä¼˜åŒ–

#### `README.md`ï¼ˆæ›´æ–°ï¼‰
- âœ… æž„å»ºçŠ¶æ€å¾½ç« 
- âœ… Docker å¿«é€Ÿå¼€å§‹
- âœ… é•œåƒä»“åº“ä¿¡æ¯
- âœ… æ–‡æ¡£é“¾æŽ¥

## ðŸ“¦ ç”Ÿæˆçš„é•œåƒ

### ä¸»é•œåƒ
```
ghcr.io/azincc/gdstudio-embeded-service:latest
ghcr.io/azincc/gdstudio-embeded-service:v1.0.0
```

### åˆ†ç¦»é•œåƒ
```
ghcr.io/azincc/gdstudio-embeded-service-api:latest
ghcr.io/azincc/gdstudio-embeded-service-worker:latest
```

### æ”¯æŒæž¶æž„
- âœ… linux/amd64
- âœ… linux/arm64

## ðŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹ï¼ˆç”Ÿäº§çŽ¯å¢ƒï¼‰

```bash
# 1. ä¸‹è½½é…ç½®
wget https://raw.githubusercontent.com/Azincc/gdstudio-embeded-service/main/docker-compose.prod.yml

# 2. åˆ›å»º .env
cat > .env << EOF
NAVIDROME_BASE_URL=http://your-navidrome:4533
NAVIDROME_USER=admin
NAVIDROME_PASSWORD=your_password
NAVIDROME_MUSIC_DIR=/path/to/music
API_KEY=your-secure-api-key
EOF

# 3. å¯åŠ¨
docker-compose -f docker-compose.prod.yml up -d

# 4. æ£€æŸ¥
curl http://localhost:8080/healthz
```

### å‘å¸ƒæ–°ç‰ˆæœ¬

```bash
# 1. åˆ›å»ºæ ‡ç­¾
git tag -a v1.0.0 -m "Release v1.0.0"
git push origin v1.0.0

# 2. GitHub Actions è‡ªåŠ¨æž„å»ºå¹¶å‘å¸ƒ
# æ— éœ€æ‰‹åŠ¨æ“ä½œï¼

# 3. ä½¿ç”¨æ–°ç‰ˆæœ¬
docker-compose -f docker-compose.prod.yml pull
docker-compose -f docker-compose.prod.yml up -d
```

## ðŸŽ¯ è§¦å‘æ¡ä»¶

GitHub Actions ä¼šåœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨è§¦å‘ï¼š

1. **æŽ¨é€åˆ° main** â†’ æž„å»º `latest` æ ‡ç­¾
2. **æŽ¨é€åˆ° develop** â†’ æž„å»º `develop` æ ‡ç­¾
3. **æŽ¨é€æ ‡ç­¾ v1.0.0** â†’ æž„å»º `1.0.0`, `1.0`, `1`, `latest`
4. **Pull Request** â†’ æž„å»ºä½†ä¸æŽ¨é€ï¼ˆéªŒè¯ï¼‰
5. **æ‰‹åŠ¨è§¦å‘** â†’ è‡ªå®šä¹‰æž„å»º

## ðŸ“Š æ€§èƒ½æŒ‡æ ‡

### é•œåƒå¤§å°
- API é•œåƒ: ~50MB
- Worker é•œåƒ: ~50MB
- å®Œæ•´é•œåƒ: ~70MB

### æž„å»ºæ—¶é—´
- å•æž¶æž„: 3-5 åˆ†é’Ÿ
- å¤šæž¶æž„: 6-10 åˆ†é’Ÿ
- ç¼“å­˜å‘½ä¸­: 2-3 åˆ†é’Ÿ

## ðŸ”’ å®‰å…¨ç‰¹æ€§

1. âœ… éž root ç”¨æˆ·è¿è¡Œï¼ˆappuser:1000ï¼‰
2. âœ… æœ€å°åŒ–åŸºç¡€é•œåƒï¼ˆAlpineï¼‰
3. âœ… æž„å»ºäº§ç‰©ç­¾åéªŒè¯
4. âœ… å¥åº·æ£€æŸ¥å†…ç½®
5. âœ… æ•æ„Ÿä¿¡æ¯çŽ¯å¢ƒå˜é‡åŒ–

## ðŸ“š æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | ç”¨é€” |
|------|------|
| [DOCKER_DEPLOYMENT.md](./DOCKER_DEPLOYMENT.md) | å®Œæ•´çš„ Docker éƒ¨ç½²æŒ‡å— |
| [GITHUB_ACTIONS.md](./GITHUB_ACTIONS.md) | CI/CD æµç¨‹å’Œé…ç½®è¯´æ˜Ž |
| [README.md](./README.md) | é¡¹ç›®ä¸»æ–‡æ¡£ |
| [TESTING.md](./TESTING.md) | åŠŸèƒ½æµ‹è¯•æŒ‡å— |
| [QUICKSTART.md](./QUICKSTART.md) | 5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹ |

## âœ¨ ç‰¹æ€§äº®ç‚¹

### 1. é›¶é…ç½® CI/CD
- æŽ¨é€ä»£ç å³è‡ªåŠ¨æž„å»º
- æ— éœ€æ‰‹åŠ¨é…ç½® tokenï¼ˆä½¿ç”¨ GITHUB_TOKENï¼‰
- è‡ªåŠ¨æŽ¨é€åˆ° GHCR

### 2. å¤šæž¶æž„æ”¯æŒ
- æ”¯æŒ x86_64 å’Œ ARM64
- Docker è‡ªåŠ¨é€‰æ‹©åˆé€‚æž¶æž„
- æ”¯æŒæ ‘èŽ“æ´¾å’Œ Apple Silicon

### 3. çµæ´»éƒ¨ç½²
- æœ¬åœ°æž„å»º
- é¢„æž„å»ºé•œåƒ
- åˆ†ç¦»æœåŠ¡éƒ¨ç½²

### 4. æ˜“äºŽæ‰©å±•
- Worker å¯æ°´å¹³æ‰©å±•
- ä¸€é”®æ‰©å±•åˆ° N ä¸ªå®žä¾‹
- ç‹¬ç«‹çš„ API å’Œ Worker é•œåƒ

### 5. ç”Ÿäº§å°±ç»ª
- å¥åº·æ£€æŸ¥
- éž root ç”¨æˆ·
- æž„å»ºç­¾åéªŒè¯
- å®Œæ•´çš„ç›‘æŽ§å’Œæ—¥å¿—

## ðŸ”§ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯åš

1. **æŽ¨é€ä»£ç è§¦å‘é¦–æ¬¡æž„å»º**
   ```bash
   git add .
   git commit -m "feat: add Docker CI/CD"
   git push origin main
   ```

2. **æŸ¥çœ‹æž„å»ºçŠ¶æ€**
   - è®¿é—® GitHub Actions é¡µé¢
   - è§‚å¯Ÿæž„å»ºè¿‡ç¨‹

3. **éªŒè¯é•œåƒ**
   ```bash
   docker pull ghcr.io/azincc/gdstudio-embeded-service:latest
   docker run --rm ghcr.io/azincc/gdstudio-embeded-service:latest ./api --version
   ```

### å¯é€‰é…ç½®

1. **é…ç½® Docker Hub**ï¼ˆå¯é€‰ï¼‰
   - æ·»åŠ  `DOCKERHUB_USERNAME` secret
   - æ·»åŠ  `DOCKERHUB_TOKEN` secret
   - é•œåƒä¼šåŒæ—¶æŽ¨é€åˆ° Docker Hub

2. **é…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼ˆå»ºè®®ï¼‰
   - æ·»åŠ å•å…ƒæµ‹è¯•
   - åœ¨ CI ä¸­è¿è¡Œæµ‹è¯•
   - æµ‹è¯•é€šè¿‡åŽæ‰æž„å»ºé•œåƒ

3. **æ·»åŠ ä»£ç è´¨é‡æ£€æŸ¥**ï¼ˆå»ºè®®ï¼‰
   - golangci-lint
   - å®‰å…¨æ‰«æ
   - ä»£ç è¦†ç›–çŽ‡

## ðŸŽ‰ å®ŒæˆçŠ¶æ€

| ä»»åŠ¡ | çŠ¶æ€ |
|------|------|
| GitHub Actions å·¥ä½œæµ | âœ… å®Œæˆ |
| Dockerfile ä¼˜åŒ– | âœ… å®Œæˆ |
| Docker Compose é…ç½® | âœ… å®Œæˆ |
| éƒ¨ç½²æ–‡æ¡£ | âœ… å®Œæˆ |
| CI/CD æ–‡æ¡£ | âœ… å®Œæˆ |
| README æ›´æ–° | âœ… å®Œæˆ |

## ðŸ’¡ æœ€ä½³å®žè·µ

1. **ç‰ˆæœ¬ç®¡ç†**
   - ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆv1.0.0ï¼‰
   - ç”Ÿäº§çŽ¯å¢ƒé”å®šç‰ˆæœ¬å·
   - é¿å…ä½¿ç”¨ `latest` åœ¨ç”Ÿäº§çŽ¯å¢ƒ

2. **å®‰å…¨æ€§**
   - å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ
   - æ‰«ææ¼æ´ž
   - ä½¿ç”¨éž root ç”¨æˆ·

3. **æ€§èƒ½**
   - ä½¿ç”¨æž„å»ºç¼“å­˜
   - ä¼˜åŒ–é•œåƒå±‚çº§
   - æœ€å°åŒ–é•œåƒå¤§å°

4. **ç›‘æŽ§**
   - é…ç½®å¥åº·æ£€æŸ¥
   - æ”¶é›†æ—¥å¿—
   - ç›‘æŽ§èµ„æºä½¿ç”¨

---

**åˆ›å»ºæ—¥æœŸ**: 2026-02-19
**å®Œæˆè€…**: Claude  Code
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ªï¼Œå¯ä»¥æŽ¨é€ä»£ç è§¦å‘é¦–æ¬¡æž„å»º
